- hosts:
    - web
  vars_files:
    - vars.yml
  tasks:
    - name: config yum conf
      debug:
        msg: "config yum conf"

    # shell: "echo exclude=java* && uniq /etc/yum.conf"
    - name: 1.install srsp.oracle-java
      shell: "echo exclude=java* >> /etc/yum.conf"
      when: enable_oracle_java

    - name: 2.install bertvv.dnsmasq
      include_role:
        name: bertvv.dnsmasq
      vars_files:
        - vars.yml
      when: enable_dnsmasq

    - name: 3.install kyl191.openvpn
      include_role:
        name: kyl191.openvpn
      vars_files:
        - vars.yml
      when: enable_openvpn

    - name: 4.install geerlingguy.jenkins
      include_role:
        name: geerlingguy.jenkins
      vars_files:
        - vars.yml
      when: enable_jenkins

    - name: 5.install geerlingguy.nginx
      include_role:
        name: geerlingguy.nginx
      become: true
      vars_files:
        - vars.yml
      when: enable_nginx

    - name: 6.install cifaz.zentao
      include_role:
        name: cifaz.zentao
      vars_files:
        - vars.yml
      when: enable_zentao

    - name: 7.install cifaz.xwiki
      include_role:
        name: cifaz.xwiki
      vars_files:
        - vars.yml
      when: enable_xwiki

#    装jumpserver前, 装好redis和mysql, 最好先运行dbserver
    - name: 8.install cifaz.jumpserver
      include_role:
        name: cifaz.jumpserver
      vars_files:
        - vars.yml
      when: enable_jumpserver

    - name: install geerlingguy.gitlab
      include_role:
        name: geerlingguy.gitlab
      vars_files:
          - vars.yml
      when: enable_gitlab

    - name: install cifaz.gitlab-zh
      include_role:
        name: cifaz.gitlab-zh
      vars_files:
          - vars.yml
      when: enable_gitlab_zh

    - name: install savoirfairelinux.nexus3-oss
      include_role:
        name: savoirfairelinux.nexus3-oss
      vars_files:
          - vars.yml
      when: enable_nexus3

    - name: install geerlingguy.nodejs
      include_role:
        name: geerlingguy.nodejs
      vars_files:
          - vars.yml
      when: enable_nodejs

    - name: install srsp.oracle-java
      include_role:
        name: srsp.oracle-java
      vars_files:
          - vars.yml
      when: enable_oracle_java

    - name: install zaxos.tomcat-ansible-role
      include_role:
        name: zaxos.tomcat-ansible-role
      vars_files:
          - vars.yml
      when: enable_tomcat

    - name: install srsp.oracle-java
      include_role:
        name: srsp.oracle-java
      vars_files:
          - vars.yml
      when: enable_oracle_java

    - name: check data_dir exists
      file:
        path: "{{ data_dir }}"
        state: directory

    - name: check log_dir exists
      file:
        path: "{{ log_dir }}"
        state: directory

    - name: check zookeeper_tarball_dir exists
      file:
        path: "{{ zookeeper_tarball_dir }}"
        state: directory

    - name: install AnsibleShipyard.ansible-zookeeper
      include_role:
        name: AnsibleShipyard.ansible-zookeeper
      vars_files:
          - vars.yml
      when: enable_zookeeper

    - name: install geerlingguy.nodejs
      include_role:
        name: geerlingguy.nodejs
      vars_files:
          - vars.yml
      when: enable_nodejs

    - name: install srsp.oracle-java
      include_role:
        name: srsp.oracle-java
      vars_files:
          - vars.yml
      when: enable_oracle_java

    - name: install zaxos.tomcat-ansible-role
      include_role:
        name: zaxos.tomcat-ansible-role
      vars_files:
          - vars.yml
      when: enable_tomcat

